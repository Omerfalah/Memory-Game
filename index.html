<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon Says Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .button-active {
            filter: brightness(1.5);
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        .game-over {
            background: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const SimonGame = () => {
            // Game settings
            const difficulties = {
                beginner: { colors: ['red', 'green', 'blue'], name: 'Beginner' },
                intermediate: { colors: ['red', 'green', 'blue', 'yellow'], name: 'Intermediate' },
                hard: { colors: ['red', 'green', 'blue', 'yellow', 'orange', 'purple'], name: 'Hard' }
            };

            // Game state
            const [gameState, setGameState] = useState('menu'); // menu, playing, gameover
            const [difficulty, setDifficulty] = useState(null);
            const [sequence, setSequence] = useState([]);
            const [userSequence, setUserSequence] = useState([]);
            const [activeButton, setActiveButton] = useState(null);
            const [score, setScore] = useState(0);
            const [message, setMessage] = useState('Select a difficulty to start');
            const [isPlayingSequence, setIsPlayingSequence] = useState(false);
            const [acceptingInput, setAcceptingInput] = useState(false);

            const audioContextRef = useRef(null);

            // Play sound for a color using a simple beep
            const playSound = useCallback((color) => {
                try {
                    if (!audioContextRef.current) {
                        const AudioContext = window.AudioContext || window.webkitAudioContext;
                        audioContextRef.current = new AudioContext();
                    }

                    const oscillator = audioContextRef.current.createOscillator();
                    const gainNode = audioContextRef.current.createGain();
                    
                    // Set different frequencies for each color
                    let frequency;
                    switch(color) {
                        case 'red': frequency = 220; break;
                        case 'green': frequency = 330; break;
                        case 'blue': frequency = 440; break;
                        case 'yellow': frequency = 550; break;
                        case 'orange': frequency = 660; break;
                        case 'purple': frequency = 770; break;
                        default: frequency = 440;
                    }
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContextRef.current.destination);
                    
                    // Set up the gain envelope
                    const now = audioContextRef.current.currentTime;
                    gainNode.gain.setValueAtTime(0, now);
                    gainNode.gain.linearRampToValueAtTime(0.3, now + 0.05);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.4);
                    
                    oscillator.start(now);
                    oscillator.stop(now + 0.4);
                } catch (e) {
                    console.log('Audio not supported:', e);
                }
            }, []);

            // Start a new game
            const startGame = (selectedDifficulty) => {
                const selected = difficulties[selectedDifficulty];
                setDifficulty(selected);
                setSequence([]);
                setUserSequence([]);
                setScore(0);
                setGameState('playing');
                setMessage('Starting game...');
                setIsPlayingSequence(false);
                setAcceptingInput(false);

                // Start with first color after a brief delay
                setTimeout(() => {
                    const randomColor = selected.colors[Math.floor(Math.random() * selected.colors.length)];
                    const newSeq = [randomColor];
                    setSequence(newSeq);
                    playSequence(newSeq);
                }, 1000);
            };

            // Add a new random color to the sequence
            const addToSequence = useCallback(() => {
                if (!difficulty) return;
                
                const newColor = difficulty.colors[Math.floor(Math.random() * difficulty.colors.length)];
                setSequence(prevSeq => {
                    const newSeq = [...prevSeq, newColor];
                    // Play the sequence after state update
                    setTimeout(() => playSequence(newSeq), 100);
                    return newSeq;
                });
                setUserSequence([]);
            }, [difficulty]);

            // Play the current sequence
            const playSequence = useCallback((seq) => {
                setIsPlayingSequence(true);
                setAcceptingInput(false);
                setMessage('Watch the sequence...');
                setActiveButton(null);
                
                seq.forEach((color, index) => {
                    setTimeout(() => {
                        setActiveButton(color);
                        playSound(color);
                        setTimeout(() => setActiveButton(null), 500);
                    }, (index) * 800 + 500);
                });

                setTimeout(() => {
                    setIsPlayingSequence(false);
                    setAcceptingInput(true);
                    setMessage('Your turn! Repeat the sequence');
                    setActiveButton(null);
                }, seq.length * 800 + 1000);
            }, [playSound]);

            // Handle button click
            const handleButtonClick = (color) => {
                if (gameState !== 'playing' || !acceptingInput || isPlayingSequence) {
                    return;
                }
                
                // Visual and audio feedback
                setActiveButton(color);
                playSound(color);
                setTimeout(() => setActiveButton(null), 200);
                
                // Update user sequence
                const newUserSequence = [...userSequence, color];
                setUserSequence(newUserSequence);
                
                // Check if user's click matches the sequence
                if (sequence[newUserSequence.length - 1] !== color) {
                    setTimeout(() => gameOver(), 300);
                    return;
                }
                
                // If sequence is complete and correct
                if (newUserSequence.length === sequence.length) {
                    setScore(prev => prev + 1);
                    setAcceptingInput(false);
                    setMessage('Correct! Next round...');
                    setTimeout(() => addToSequence(), 1200);
                }
            };

            // Game over
            const gameOver = () => {
                setGameState('gameover');
                setAcceptingInput(false);
                setIsPlayingSequence(false);
                setMessage(`Game Over! Your score: ${score}`);
            };

            // Reset game
            const resetGame = () => {
                setGameState('menu');
                setDifficulty(null);
                setSequence([]);
                setUserSequence([]);
                setScore(0);
                setMessage('Select a difficulty to start');
                setIsPlayingSequence(false);
                setAcceptingInput(false);
                setActiveButton(null);
            };

            // Button component
            const GameButton = ({ color }) => {
                const baseClasses = `w-20 h-20 md:w-24 md:h-24 rounded-full m-2 transition-all duration-200 flex items-center justify-center text-white font-bold text-xl cursor-pointer select-none`;
                const colorClasses = {
                    red: 'bg-red-600 hover:bg-red-500',
                    green: 'bg-green-600 hover:bg-green-500',
                    blue: 'bg-blue-600 hover:bg-blue-500',
                    yellow: 'bg-yellow-500 hover:bg-yellow-400',
                    orange: 'bg-orange-500 hover:bg-orange-400',
                    purple: 'bg-purple-600 hover:bg-purple-500'
                };

                const isDisabled = isPlayingSequence || !acceptingInput;
                
                return (
                    <button
                        className={`${baseClasses} ${colorClasses[color]} ${
                            activeButton === color ? 'button-active' : ''
                        } ${isDisabled ? 'opacity-60 cursor-not-allowed' : ''}`}
                        onClick={() => handleButtonClick(color)}
                        disabled={isDisabled}
                    >
                        {color.charAt(0).toUpperCase() + color.slice(1)}
                    </button>
                );
            };

            // Menu screen
            if (gameState === 'menu') {
                return (
                    <div className="text-center fade-in">
                        <h1 className="text-4xl md:text-5xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                            Flash Back!
                        </h1>
                        <p className="text-xl mb-8">{message}</p>
                        
                        <div className="grid grid-cols-1 gap-4 max-w-md mx-auto">
                            {Object.entries(difficulties).map(([key, { name, colors }]) => (
                                <button
                                    key={key}
                                    className="px-6 py-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors text-lg font-medium flex items-center justify-between"
                                    onClick={() => startGame(key)}
                                >
                                    <span>{name}</span>
                                    <div className="flex">
                                        {colors.map(color => (
                                            <div 
                                                key={color} 
                                                className="w-4 h-4 rounded-full ml-1"
                                                style={{ backgroundColor: color }}
                                            />
                                        ))}
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }

            // Game over screen
            if (gameState === 'gameover') {
                return (
                    <div className="text-center fade-in">
                        <div className="game-over fixed inset-0 flex items-center justify-center z-10">
                            <div className="bg-gray-800 p-8 rounded-lg max-w-md w-full mx-4">
                                <h2 className="text-3xl font-bold mb-4">Game Over!</h2>
                                <p className="text-xl mb-2">Difficulty: {difficulty?.name}</p>
                                <p className="text-xl mb-6">Your score: {score}</p>
                                <button
                                    className="px-6 py-3 bg-pink-600 rounded-lg hover:bg-pink-500 transition-colors text-lg font-medium w-full"
                                    onClick={resetGame}
                                >
                                    Play Again
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Game screen
            return (
                <div className="text-center fade-in">
                    <h1 className="text-3xl md:text-4xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                        Flash Back!
                    </h1>
                    
                    <div className="mb-6">
                        <p className="text-xl mb-2">Difficulty: {difficulty?.name}</p>
                        <p className="text-xl mb-2">Score: {score}</p>
                        <p className="text-xl mb-2">Round: {sequence.length}</p>
                        <p className="text-lg text-gray-300">{message}</p>
                        {acceptingInput && (
                            <p className="text-sm text-green-400 mt-2">
                                Progress: {userSequence.length}/{sequence.length}
                            </p>
                        )}
                    </div>
                    
                    <div className="flex flex-wrap justify-center max-w-md mx-auto">
                        {difficulty?.colors.map(color => (
                            <GameButton key={color} color={color} />
                        ))}
                    </div>
                    
                    <button
                        className="mt-8 px-6 py-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors text-lg font-medium"
                        onClick={resetGame}
                    >
                        Back to Menu
                    </button>
                </div>
            );
        };

        const App = () => {
            return (
                <div className="container mx-auto px-4">
                    <SimonGame />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>